# Survey Platform Development Rules

## Code Quality and Linting

**ALWAYS run linting and formatting before committing:**

1. **Before committing code changes:**
   ```bash
   cd backend
   npm run lint
   ```

2. **Fix auto-fixable issues:**
   ```bash
   cd backend
   npm run lint -- --fix
   ```

3. **TypeScript strict mode is enabled** - avoid `any` types:
   - Create proper type definitions for webhook payloads, API responses, etc.
   - Use type assertions (`as Type`) only when necessary and safe
   - Prefer interfaces/types over `any` for better type safety

4. **Prettier formatting** is enforced:
   - Run `npm run lint -- --fix` to auto-format code
   - Follow existing code style (2 spaces, trailing commas, etc.)

5. **Common linting rules:**
   - No `any` types without proper justification
   - No unused variables
   - Async functions should have `await` expressions (or disable rule with comment)
   - Use proper error handling with typed errors

## Prisma Schema Changes and Migrations

When making changes to `backend/prisma/schema.prisma`:

1. **Always create a migration** after schema changes:
   ```bash
   cd backend
   npx prisma migrate dev --create-only --name descriptive_migration_name
   ```

2. **Review the migration SQL** in `backend/prisma/migrations/[timestamp]_[name]/migration.sql` before applying

3. **Apply migration locally**:
   ```bash
   cd backend
   npm run prisma:migrate
   # or
   npx prisma migrate dev
   ```

4. **For production deployments**:
   - Migrations are applied using `prisma migrate deploy` (not `migrate dev`)
   - The production migration command is: `npm run prisma:migrate:deploy` in the backend directory
   - This applies pending migrations without creating new ones

5. **After schema changes**:
   - Prisma Client is automatically regenerated during `npm run build`
   - If needed manually: `npm run prisma:generate`

6. **Migration workflow**:
   - Development: `prisma migrate dev` (creates and applies migration)
   - Production: `prisma migrate deploy` (only applies existing migrations)
   - Never use `prisma db push` in production - it doesn't track migrations

## Important Notes

- Schema changes require migrations - don't skip this step
- Always test migrations locally before deploying
- Check migration status: `npx prisma migrate status`
- Migrations are tracked in `backend/prisma/migrations/`
