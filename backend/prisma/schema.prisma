generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String   @id @default(cuid())
  clerkId        String   @unique
  email          String
  name           String?
  organizationId String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
}

model Organization {
  id         String   @id @default(cuid())
  clerkOrgId String   @unique
  name       String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  users                 User[]
  questionBankQuestions QuestionBankQuestion[]
  properties            Property[]
}

model Property {
  id              String   @id @default(cuid())
  name            String
  address         String
  type            String
  subtype         String
  managementModel String
  city            String
  state           String
  country         String
  sizeSqFt        Int
  class           String
  organizationId  String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  surveys      Survey[]
}

model Survey {
  id          String   @id @default(cuid())
  title       String
  description String?
  propertyId  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  property  Property   @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  questions Question[]
  responses Response[]
}

model Question {
  id                     String   @id @default(cuid())
  surveyId               String
  text                   String
  type                   String
  order                  Int
  options                Json?
  questionBankQuestionId String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  survey               Survey                @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  questionBankQuestion QuestionBankQuestion? @relation(fields: [questionBankQuestionId], references: [id], onDelete: SetNull)
  answers              Answer[]
}

model QuestionBankQuestion {
  id             String   @id @default(cuid())
  organizationId String
  text           String
  type           String
  options        Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  surveyQuestions Question[]
}

model Response {
  id          String   @id @default(cuid())
  surveyId    String
  submittedAt DateTime @default(now())

  survey  Survey   @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  answers Answer[]
}

model Answer {
  id         String   @id @default(cuid())
  questionId String
  responseId String
  value      Json
  createdAt  DateTime @default(now())

  question Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  response Response @relation(fields: [responseId], references: [id], onDelete: Cascade)
}
